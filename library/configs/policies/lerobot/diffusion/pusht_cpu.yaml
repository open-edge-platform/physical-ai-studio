# Diffusion Policy - CPU Training Configuration
# Configuration for CPU training without GPU
#
# Usage:
#   getiaction fit --config configs/policies/lerobot/diffusion/pusht_cpu.yaml

model:
  class_path: getiaction.policies.lerobot.diffusion.Diffusion
  init_args:
    # Temporal configuration
    n_obs_steps: 2
    horizon: 16
    n_action_steps: 8

    # Lightweight backbone
    vision_backbone: resnet18
    pretrained_backbone_weights: ResNet18_Weights.IMAGENET1K_V1
    crop_shape: [64, 64] # Smaller for CPU
    crop_is_random: false
    use_group_norm: false # BatchNorm faster on CPU
    spatial_softmax_num_keypoints: 16

    # Compact U-Net
    down_dims: [128, 256, 512]
    kernel_size: 3
    n_groups: 4
    diffusion_step_embed_dim: 64

    # Diffusion configuration
    noise_scheduler_type: DDPM
    num_train_timesteps: 50
    num_inference_steps: 10
    beta_schedule: squaredcos_cap_v2
    prediction_type: epsilon

    # Optimization
    learning_rate: 1.0e-4
    optimizer_weight_decay: 1.0e-6
    scheduler_name: cosine
    scheduler_warmup_steps: 100

data:
  class_path: getiaction.data.lerobot.LeRobotDataModule
  init_args:
    repo_id: lerobot/pusht
    train_batch_size: 16 # Small batch for CPU
    episodes: [0, 1, 2, 3, 4] # Subset for testing
    data_format: lerobot
    delta_timestamps:
      action: [0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5]

trainer:
  max_steps: 1000
  accelerator: cpu
  devices: 1
  precision: 32
  log_every_n_steps: 10
  gradient_clip_val: 10.0
  enable_checkpointing: false