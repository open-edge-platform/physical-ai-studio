# Diffusion Policy - ALOHA Configuration
# Train on ALOHA bimanual manipulation tasks
#
# Usage:
#   getiaction fit --config configs/policies/lerobot/diffusion/aloha.yaml

model:
  class_path: getiaction.policies.lerobot.diffusion.Diffusion
  init_args:
    # Temporal parameters
    n_obs_steps: 2 # Stack 2 frames
    horizon: 10 # Shorter for real-time
    n_action_steps: 10 # Execute full trajectory

    # Vision backbone
    vision_backbone: resnet34 # Larger for complex scenes
    pretrained_backbone_weights: ResNet34_Weights.IMAGENET1K_V1
    crop_shape: [224, 224] # Higher resolution
    crop_is_random: true
    use_group_norm: true
    use_separate_rgb_encoder_per_camera: true # Multi-camera
    spatial_softmax_num_keypoints: 64 # More keypoints

    # U-Net architecture
    down_dims: [512, 1024, 2048] # Larger capacity
    kernel_size: 5
    n_groups: 8
    diffusion_step_embed_dim: 256

    # Diffusion process
    noise_scheduler_type: DDPM
    num_train_timesteps: 100
    num_inference_steps: 10
    beta_schedule: squaredcos_cap_v2
    prediction_type: epsilon
    clip_sample: true

    # Optimization
    learning_rate: 1.0e-4
    optimizer_weight_decay: 1.0e-6
    scheduler_name: cosine
    scheduler_warmup_steps: 1000

data:
  class_path: getiaction.data.lerobot.LeRobotDataModule
  init_args:
    repo_id: lerobot/aloha_sim_transfer_cube_human
    train_batch_size: 32
    data_format: lerobot
    delta_timestamps:
      action: [0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9] # 10 steps

trainer:
  max_epochs: 5000
  accelerator: gpu
  devices: 1
  precision: 16-mixed
  log_every_n_steps: 50
  check_val_every_n_epoch: 100
  gradient_clip_val: 10.0