# Diffusion Policy - Fast Training Configuration
# Quick prototyping with reduced model size and training time
#
# Usage:
#   getiaction fit --config configs/policies/lerobot/diffusion/pusht_fast.yaml

model:
  class_path: getiaction.policies.lerobot.diffusion.Diffusion
  init_args:
    # Temporal configuration
    n_obs_steps: 1 # Single frame
    horizon: 8 # Shorter horizon
    n_action_steps: 8 # Execute full trajectory

    # Lightweight vision backbone
    vision_backbone: resnet18
    pretrained_backbone_weights: null # Train from scratch
    crop_shape: [64, 64] # Smaller images
    crop_is_random: false # Center crop only
    use_group_norm: false # BatchNorm for speed
    spatial_softmax_num_keypoints: 16 # Fewer keypoints

    # Smaller U-Net
    down_dims: [128, 256, 512] # Reduced capacity
    kernel_size: 3 # Smaller kernels
    n_groups: 4
    diffusion_step_embed_dim: 64

    # Fast diffusion
    noise_scheduler_type: DDIM # Faster at inference
    num_train_timesteps: 50 # Fewer steps
    num_inference_steps: 5 # Fast inference
    beta_schedule: linear
    prediction_type: epsilon
    clip_sample: false # Skip clipping

    # Optimization
    learning_rate: 5.0e-4 # Higher LR
    optimizer_weight_decay: 0.0 # No weight decay
    scheduler_name: constant # No LR scheduling
    scheduler_warmup_steps: 0

data:
  class_path: getiaction.data.lerobot.LeRobotDataModule
  init_args:
    repo_id: lerobot/pusht
    train_batch_size: 128 # Larger batches
    data_format: lerobot
    delta_timestamps:
      action: [0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4] # 8 steps

trainer:
  max_epochs: 500
  accelerator: gpu
  devices: 1
  precision: 16-mixed
  log_every_n_steps: 50
  check_val_every_n_epoch: 10
  enable_checkpointing: false
